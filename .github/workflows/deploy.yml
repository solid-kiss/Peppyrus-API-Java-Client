name: Publish package to the Maven Central Repository
on:
  release:
    types: [created]
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - name: Set POM version from tag
        run: |
          TAG_FULL=${GITHUB_REF#refs/tags/}
          if [[ "$TAG_FULL" == v* ]]; then
            VERSION=${TAG_FULL#v}
            DEPLOY_REPO=https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/
          else
            VERSION=$TAG_FULL
            DEPLOY_REPO=https://s01.oss.sonatype.org/content/repositories/snapshots/
          fi
          echo "Tag full: $TAG_FULL, Using version: $VERSION"
          sed -i "s|@TAG_VERSION@|${VERSION}|g" pom.xml
          echo "DEPLOY_REPO=$DEPLOY_REPO" >> $GITHUB_ENV

      - name: Set up Maven Central Repository
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          server-id: ossrh
          server-username: MAVEN_USERNAME
          server-password: MAVEN_PASSWORD
      - name: Publish package
        run: mvn --batch-mode deploy
        env:
          MAVEN_USERNAME: ${{ secrets.OSSRH_USERNAME }}
          MAVEN_PASSWORD: ${{ secrets.OSSRH_TOKEN }}
